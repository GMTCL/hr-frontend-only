(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6740],{63:(e,t,a)=>{"use strict";var s=a(7260);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}})},854:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var s=a(2115);function r(){let[e,t]=(0,s.useState)({loading:!1,error:null,user:null,isAuthenticated:!1}),a=(0,s.useCallback)(async(e,a)=>{t(e=>({...e,loading:!0,error:null}));try{if(await new Promise(e=>setTimeout(e,1e3)),"admin@hr.com"!==e||"password"!==a)return t(e=>({...e,loading:!1,error:"อีเมลหรือรหัสผ่านไม่ถูกต้อง"})),{success:!1,error:"อีเมลหรือรหัสผ่านไม่ถูกต้อง"};{let a={id:1,email:e,name:"HR Admin",role:"admin"};return t({loading:!1,error:null,user:a,isAuthenticated:!0}),{success:!0,user:a}}}catch(a){let e="เกิดข้อผิดพลาดในการเข้าสู่ระบบ";return t(t=>({...t,loading:!1,error:e})),{success:!1,error:e}}},[]),r=(0,s.useCallback)(()=>{t({loading:!1,error:null,user:null,isAuthenticated:!1})},[]),n=(0,s.useCallback)(()=>{t(e=>({...e,error:null}))},[]);return{...e,login:a,logout:r,clearError:n}}},960:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>d,Gt:()=>l,Rz:()=>n,Wp:()=>i,aq:()=>c,ug:()=>o});let s=()=>localStorage.getItem("authToken"),r=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let a="".concat("https://hrbackoofice.mimshack-sourc.com/api").concat(e),r=(()=>{let e=s(),t={"Content-Type":"application/json",Accept:"application/json"};return e&&(t.Authorization="Bearer ".concat(e)),t})(),n=await fetch(a,{...t,headers:{...r,...t.headers}}),c=await n.json();if(!n.ok)throw Error(c.message||"HTTP error! status: ".concat(n.status));return{success:!0,data:c.data||c,message:c.message}}catch(t){return console.error("API request failed for ".concat(e,":"),t),{success:!1,message:t instanceof Error?t.message:"An unknown error occurred",errors:t}}},n={getAll:async()=>r("/employees"),getById:async e=>r("/employees/".concat(e)),create:async e=>r("/employees",{method:"POST",body:JSON.stringify(e)}),update:async(e,t)=>r("/employees/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:async e=>r("/employees/".concat(e),{method:"DELETE"})},c={getAll:async()=>r("/leave-requests"),getById:async e=>r("/leave-requests/".concat(e)),create:async e=>r("/leave-requests",{method:"POST",body:JSON.stringify(e)}),update:async(e,t)=>r("/leave-requests/".concat(e),{method:"PUT",body:JSON.stringify(t)}),approve:async e=>r("/leave-requests/".concat(e,"/status"),{method:"PUT",body:JSON.stringify({status:"approved"})}),reject:async(e,t)=>r("/leave-requests/".concat(e,"/status"),{method:"PUT",body:JSON.stringify({status:"rejected",reason:t})})},l={clockIn:async e=>r("/attendance/clock-in",{method:"POST",body:JSON.stringify({employee_id:e})}),clockOut:async e=>r("/attendance/clock-out",{method:"POST",body:JSON.stringify({employee_id:e})}),getAttendance:async(e,t)=>r(t?"/attendance?employee_id=".concat(e,"&date=").concat(t):"/attendance?employee_id=".concat(e)),getAttendanceReport:async(e,t)=>r("/attendance/summary?start_date=".concat(e,"&end_date=").concat(t))},o={getEmployeeReport:async()=>r("/reports/employees"),getAttendanceReport:async(e,t)=>r("/reports/attendance?start_date=".concat(e,"&end_date=").concat(t)),getPayrollReport:async e=>r("/reports/payroll?period=".concat(e)),getLeaveReport:async()=>r("/reports/leaves"),exportReport:async(e,t)=>r("/reports/".concat(e,"/export?format=").concat(t))},d={auth:{login:async e=>r("/auth/login",{method:"POST",body:JSON.stringify(e)}),logout:async()=>r("/auth/logout",{method:"POST"}),me:async()=>r("/auth/profile")},employee:n,department:{getAll:async()=>r("/departments"),getById:async e=>r("/departments/".concat(e)),create:async e=>r("/departments",{method:"POST",body:JSON.stringify(e)}),update:async(e,t)=>r("/departments/".concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:async e=>r("/departments/".concat(e),{method:"DELETE"})},leave:c,attendance:l,payroll:{getAll:async()=>r("/payroll"),getById:async e=>r("/payroll/".concat(e)),process:async e=>r("/payroll/generate",{method:"POST",body:JSON.stringify({payroll_data:e})}),generateSlip:async(e,t)=>r("/payroll/export?period=".concat(encodeURIComponent(t)))},reports:o,performance:{getReviews:async e=>r(e?"/performance/reviews/".concat(e):"/performance/reviews"),createReview:async e=>r("/performance/reviews",{method:"POST",body:JSON.stringify(e)}),getGoals:async e=>r(e?"/performance/goals/".concat(e):"/performance/goals"),setGoal:async e=>r("/performance/goals",{method:"POST",body:JSON.stringify(e)})},training:{getCourses:async()=>r("/training/courses"),enrollEmployee:async(e,t)=>r("/training/enroll",{method:"POST",body:JSON.stringify({employee_id:e,course_id:t})}),getProgress:async e=>r("/training/progress/".concat(e)),markComplete:async(e,t)=>r("/training/complete",{method:"POST",body:JSON.stringify({employee_id:e,course_id:t})})},benefits:{getAll:async()=>r("/benefits"),enroll:async(e,t)=>r("/benefits/enroll",{method:"POST",body:JSON.stringify({employee_id:e,benefit_id:t})}),getEnrollments:async e=>r("/benefits/enrollments/".concat(e))},compliance:{getAudits:async()=>r("/compliance/audits"),createAudit:async e=>r("/compliance/audits",{method:"POST",body:JSON.stringify(e)}),getRegulations:async()=>r("/compliance/regulations"),trackCompliance:async e=>r("/compliance/track/".concat(e))},document:{getAll:async()=>r("/documents"),upload:async(e,t)=>{let a=new FormData;return a.append("file",e),a.append("category",t),r("/documents/upload",{method:"POST",body:a,headers:{Authorization:"Bearer ".concat(s())}})},download:async e=>r("/documents/".concat(e,"/download")),delete:async e=>r("/documents/".concat(e),{method:"DELETE"})},facialAttendance:{scanFace:async(e,t)=>r("/facial-attendance/scan",{method:"POST",body:JSON.stringify({image:e,employee_id:t})}),getAttendanceRecords:async e=>r("/facial-attendance/records?date=".concat(e)),getAttendanceSummary:async e=>r("/facial-attendance/summary?date=".concat(e)),getMissingAttendance:async e=>r("/facial-attendance/missing?date=".concat(e)),sendHRNotification:async e=>r("/facial-attendance/notify-hr",{method:"POST",body:JSON.stringify(e)}),recordPenalty:async e=>r("/facial-attendance/penalty",{method:"POST",body:JSON.stringify(e)}),getPenaltyHistory:async e=>r("/facial-attendance/penalty-history/".concat(e)),getSettings:async()=>r("/facial-attendance/settings"),updateSettings:async e=>r("/facial-attendance/settings",{method:"PUT",body:JSON.stringify(e)}),getTimeSlots:async()=>r("/facial-attendance/time-slots"),updateTimeSlots:async e=>r("/facial-attendance/time-slots",{method:"PUT",body:JSON.stringify({time_slots:e})}),exportReport:async(e,t,a)=>r("/facial-attendance/export?start_date=".concat(e,"&end_date=").concat(t,"&format=").concat(a))}},i={setAuthToken:e=>{localStorage.setItem("authToken",e)},removeAuthToken:()=>{localStorage.removeItem("authToken")},isAuthenticated:()=>null!==s(),formatError:e=>{if("string"==typeof e)return e;if("object"==typeof e&&null!==e){if("message"in e&&"string"==typeof e.message)return e.message;if("errors"in e){let t=Object.values(e.errors)[0];return Array.isArray(t)?t[0]:String(t)}}return"An unexpected error occurred"}}},1834:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var s=a(5155),r=a(2115),n=a(2619),c=a.n(n),l=a(63),o=a(854),d=a(960);function i(){let{isAuthenticated:e,loading:t}=(0,o.A)(),{leaves:a,loading:n,error:i,approveLeave:m,rejectLeave:u,clearError:x}=(()=>{let[e,t]=(0,r.useState)({leaves:[],loading:!1,error:null}),a=(0,r.useCallback)(async()=>{try{t(e=>({...e,loading:!0,error:null}));let e=await d.aq.getAll();e.success&&e.data?t({leaves:e.data,loading:!1,error:null}):t(t=>({...t,loading:!1,error:e.message||"Failed to fetch leave requests"}))}catch(e){t(t=>({...t,loading:!1,error:e instanceof Error?e.message:"An error occurred"}))}},[]),s=(0,r.useCallback)(async e=>{try{t(e=>({...e,loading:!0,error:null}));let a=await d.aq.create(e);if(a.success&&a.data)return t(e=>({leaves:[...e.leaves,a.data],loading:!1,error:null})),{success:!0,data:a.data};return t(e=>({...e,loading:!1,error:a.message||"Failed to create leave request"})),{success:!1,error:a.message||"Failed to create leave request"}}catch(a){let e=a instanceof Error?a.message:"An error occurred";return t(t=>({...t,loading:!1,error:e})),{success:!1,error:e}}},[]),n=(0,r.useCallback)(async(e,a)=>{try{t(e=>({...e,loading:!0,error:null}));let s=await d.aq.update(e,a);if(s.success&&s.data)return t(t=>({leaves:t.leaves.map(t=>t.id===e?s.data:t),loading:!1,error:null})),{success:!0,data:s.data};return t(e=>({...e,loading:!1,error:s.message||"Failed to update leave request"})),{success:!1,error:s.message||"Failed to update leave request"}}catch(a){let e=a instanceof Error?a.message:"An error occurred";return t(t=>({...t,loading:!1,error:e})),{success:!1,error:e}}},[]),c=(0,r.useCallback)(async e=>{try{t(e=>({...e,loading:!0,error:null}));let a=await d.aq.approve(e);if(a.success&&a.data)return t(t=>({leaves:t.leaves.map(t=>t.id===e?a.data:t),loading:!1,error:null})),{success:!0,data:a.data};return t(e=>({...e,loading:!1,error:a.message||"Failed to approve leave request"})),{success:!1,error:a.message||"Failed to approve leave request"}}catch(a){let e=a instanceof Error?a.message:"An error occurred";return t(t=>({...t,loading:!1,error:e})),{success:!1,error:e}}},[]),l=(0,r.useCallback)(async(e,a)=>{try{t(e=>({...e,loading:!0,error:null}));let s=await d.aq.reject(e,a);if(s.success&&s.data)return t(t=>({leaves:t.leaves.map(t=>t.id===e?s.data:t),loading:!1,error:null})),{success:!0,data:s.data};return t(e=>({...e,loading:!1,error:s.message||"Failed to reject leave request"})),{success:!1,error:s.message||"Failed to reject leave request"}}catch(a){let e=a instanceof Error?a.message:"An error occurred";return t(t=>({...t,loading:!1,error:e})),{success:!1,error:e}}},[]),o=(0,r.useCallback)(async e=>{try{let t=await d.aq.getById(e);if(t.success&&t.data)return{success:!0,data:t.data};return{success:!1,error:t.message||"Leave request not found"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"An error occurred"}}},[]),i=(0,r.useCallback)(()=>{t(e=>({...e,error:null}))},[]);return(0,r.useEffect)(()=>{a()},[a]),{...e,fetchLeaves:a,createLeave:s,updateLeave:n,approveLeave:c,rejectLeave:l,getLeaveById:o,clearError:i}})(),g=(0,l.useRouter)(),[y,p]=(0,r.useState)("all"),[h,f]=(0,r.useState)("all");(0,r.useEffect)(()=>{t||e||g.push("/th/login")},[e,t,g]);let b=a.filter(e=>{let t="all"===y||e.status===y,a="all"===h||e.leave_type===h;return t&&a}),j=e=>{switch(e){case"pending":return"รออนุมัติ";case"approved":return"อนุมัติแล้ว";case"rejected":return"ไม่อนุมัติ";default:return e}},v=async e=>{let t=await m(e);t.success||alert("ไม่สามารถอนุมัติใบลาได้: "+t.error)},N=async e=>{let t=prompt("กรุณาระบุเหตุผลในการไม่อนุมัติ:");if(t){let a=await u(e,t);a.success||alert("ไม่สามารถปฏิเสธใบลาได้: "+a.error)}};return t||n?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"กำลังโหลด..."})]})}):e?(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between items-center py-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)(c(),{href:"/th/dashboard",className:"text-gray-600 hover:text-gray-900 transition-colors",children:"← กลับสู่แดชบอร์ด"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"ระบบลา"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"จัดการใบลาและอนุมัติการลา"})]})]}),(0,s.jsx)("div",{className:"flex items-center space-x-4",children:(0,s.jsx)(c(),{href:"/th/leaves/new",className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:"ส่งใบลาใหม่"})})]})})}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[i&&(0,s.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:i}),(0,s.jsx)("button",{onClick:x,className:"text-red-600 hover:text-red-800 underline",children:"ปิด"})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-yellow-600 text-xl",children:"⏳"})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"รออนุมัติ"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:a.filter(e=>"pending"===e.status).length})]})]})}),(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-green-600 text-xl",children:"✅"})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"อนุมัติแล้ว"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:a.filter(e=>"approved"===e.status).length})]})]})}),(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-red-600 text-xl",children:"❌"})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"ไม่อนุมัติ"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:a.filter(e=>"rejected"===e.status).length})]})]})}),(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-blue-600 text-xl",children:"\uD83D\uDCCB"})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"ทั้งหมด"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:a.length})]})]})})]}),(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-sm border p-6 mb-6",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"สถานะ"}),(0,s.jsx)("select",{value:y,onChange:e=>p(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:["all","pending","approved","rejected"].map(e=>(0,s.jsx)("option",{value:e,children:"all"===e?"ทุกสถานะ":j(e)},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ประเภทการลา"}),(0,s.jsx)("select",{value:h,onChange:e=>f(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:["all","ลาป่วย","ลาพักร้อน","ลาบุคคล","ลาคลอด","ลาศึกษา"].map(e=>(0,s.jsx)("option",{value:e,children:"all"===e?"ทุกประเภท":e},e))})]})]})}),(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border overflow-hidden",children:[(0,s.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,s.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["รายการใบลา (",b.length," รายการ)"]})}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"พนักงาน"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ประเภท"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"วันที่ลา"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"จำนวนวัน"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"เหตุผล"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"สถานะ"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"การดำเนินการ"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.employee?"".concat(e.employee.first_name," ").concat(e.employee.last_name):"ไม่ระบุ"}),(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:["ส่งเมื่อ: ",e.created_at?new Date(e.created_at).toLocaleDateString("th-TH"):"ไม่ระบุ"]})]}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:e.leave_type})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsxs)("div",{className:"text-sm text-gray-900",children:[e.start_date," - ",e.end_date]})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsxs)("div",{className:"text-sm text-gray-900",children:[Math.ceil((new Date(e.end_date).getTime()-new Date(e.start_date).getTime())/864e5)+1," วัน"]})}),(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsx)("div",{className:"text-sm text-gray-900 max-w-xs truncate",children:e.reason})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat((e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(e.status)),children:j(e.status)})}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:["pending"===e.status&&(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{onClick:()=>v(e.id),className:"text-green-600 hover:text-green-900 transition-colors",children:"อนุมัติ"}),(0,s.jsx)("button",{onClick:()=>N(e.id),className:"text-red-600 hover:text-red-900 transition-colors",children:"ไม่อนุมัติ"})]}),"pending"!==e.status&&(0,s.jsx)("span",{className:"text-gray-400",children:"-"})]})]},e.id))})]})})]}),0===b.length&&(0,s.jsx)("div",{className:"text-center py-12",children:(0,s.jsx)("div",{className:"text-gray-500 text-lg",children:"ไม่พบใบลาที่ตรงกับเงื่อนไขการค้นหา"})})]})]}):null}},9485:(e,t,a)=>{Promise.resolve().then(a.bind(a,1834))}},e=>{e.O(0,[2619,8441,1255,7358],()=>e(e.s=9485)),_N_E=e.O()}]);