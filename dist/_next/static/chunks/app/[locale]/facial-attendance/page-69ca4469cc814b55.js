(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8642],{3617:(e,s,t)=>{Promise.resolve().then(t.bind(t,9849))},9849:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>n});var a=t(5155),l=t(2115),r=t(2328),i=t(63);function n(){let{isAuthenticated:e,loading:s,user:t}=(0,r.As)(),n=(0,i.useRouter)(),c=(0,l.useRef)(null),d=(0,l.useRef)(null),[x,o]=(0,l.useState)(!1),[m,h]=(0,l.useState)(null),[g,u]=(0,l.useState)(null),[p,j]=(0,l.useState)(new Date),[b,y]=(0,l.useState)([]);(0,l.useEffect)(()=>{s||e||n.replace("./login")},[e,s,n]),(0,l.useEffect)(()=>{let e=setInterval(()=>{j(new Date)},1e3);return()=>clearInterval(e)},[]);let N=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480,facingMode:"user"}});c.current&&(c.current.srcObject=e)}catch(e){console.error("Error accessing camera:",e),alert("ไม่สามารถเข้าถึงกล้องได้ กรุณาอนุญาตการเข้าถึงกล้อง")}},f=async()=>{if((()=>{if(c.current&&d.current){let e=d.current,s=c.current,t=e.getContext("2d");if(t)return e.width=s.videoWidth,e.height=s.videoHeight,t.drawImage(s,0,0),e.toDataURL("image/jpeg",.8)}return null})()){o(!0),h(null);try{await new Promise(e=>setTimeout(e,2e3));let e={success:!0,employeeId:(null==t?void 0:t.id)||1,employeeName:(null==t?void 0:t.name)||"John Doe",confidence:.95,timestamp:new Date().toISOString(),type:g||"checkin"};h(JSON.stringify(e,null,2)),y(s=>[e,...s.slice(0,9)]),12>p.getHours()?u("checkin"):u("checkout")}catch(e){h("เกิดข้อผิดพลาดในการสแกนใบหน้า")}finally{o(!1)}}};return s?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})}):e?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 p-6",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"ระบบสแกนใบหน้าเช็คชื่อ"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"ระบบบันทึกการเข้าออกงานด้วยเทคโนโลยี Facial Recognition"})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-2xl font-mono text-indigo-600",children:p.toLocaleTimeString("th-TH")}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:p.toLocaleDateString("th-TH",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"กล้องสแกนใบหน้า"}),(0,a.jsxs)("div",{className:"relative bg-gray-100 rounded-lg overflow-hidden mb-4",children:[(0,a.jsx)("video",{ref:c,autoPlay:!0,playsInline:!0,className:"w-full h-64 object-cover"}),(0,a.jsx)("canvas",{ref:d,className:"hidden"}),x&&(0,a.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center text-white",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-2"}),(0,a.jsx)("p",{children:"กำลังสแกนใบหน้า..."})]})})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:N,className:"flex-1 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg transition-colors",children:"เปิดกล้อง"}),(0,a.jsx)("button",{onClick:()=>{c.current&&c.current.srcObject&&(c.current.srcObject.getTracks().forEach(e=>e.stop()),c.current.srcObject=null)},className:"flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg transition-colors",children:"ปิดกล้อง"})]}),(0,a.jsx)("button",{onClick:f,disabled:x,className:"w-full mt-4 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400 text-white py-3 px-4 rounded-lg transition-colors font-semibold",children:x?"กำลังสแกน...":"สแกนใบหน้าเช็คชื่อ"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"ผลการสแกน"}),m?(0,a.jsx)("div",{className:"bg-gray-50 rounded-lg p-4",children:(0,a.jsx)("pre",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:m})}):(0,a.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCF7"}),(0,a.jsx)("p",{children:"ยังไม่มีการสแกน"})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"สถานะการเข้างาน"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[(0,a.jsx)("span",{className:"text-green-700 font-medium",children:"เช็คชื่อเข้า"}),(0,a.jsx)("span",{className:"text-green-600",children:"✓ เสร็จสิ้น"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,a.jsx)("span",{className:"text-gray-700 font-medium",children:"เช็คชื่อออก"}),(0,a.jsx)("span",{className:"text-gray-500",children:"- รอการสแกน"})]})]})]})]})]}),(0,a.jsxs)("div",{className:"mt-6 bg-white rounded-lg shadow-sm p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"ประวัติการสแกนล่าสุด"}),b.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"เวลา"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ชื่อพนักงาน"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ประเภท"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ความแม่นยำ"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:b.map((e,s)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(e.timestamp).toLocaleString("th-TH")}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.employeeName}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat("checkin"===e.type?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"),children:"checkin"===e.type?"เข้า":"ออก"})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[(100*e.confidence).toFixed(1),"%"]})]},s))})]})}):(0,a.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCCB"}),(0,a.jsx)("p",{children:"ยังไม่มีประวัติการสแกน"})]})]})]})}):null}}},e=>{e.O(0,[9243,8441,1255,7358],()=>e(e.s=3617)),_N_E=e.O()}]);